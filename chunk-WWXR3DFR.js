import{a as Vt,b as Pt,c as Ot,d as Ft,e as Ut,f as O}from"./chunk-NU7Q2XVW.js";import{a as k,b as A}from"./chunk-EKA7DNXJ.js";import{h as Dt}from"./chunk-OZECPP75.js";import"./chunk-54PG2AAV.js";import"./chunk-EBCVRUKI.js";import{a as tt,b as wt,f as et,g as it,i as at,j as nt}from"./chunk-BJM7LMXK.js";import{b as W,c as C,e as L,f as $,i as H,j,k as Q,l as G,m as kt,n as At,o as q,p as Z,q as Y,r as K,s as J}from"./chunk-LT2PDRQ3.js";import"./chunk-S5WO7LK6.js";import{a as B,b as z,d as X}from"./chunk-T4H2DEYZ.js";import{Ac as Tt,Bc as M,Cc as T,Da as V,Dc as y,E as pt,Ec as yt,Fa as u,Ga as h,Jb as U,K as _,Kb as St,L as p,Lb as Mt,Nb as Rt,Ob as N,P as gt,Qa as r,R as ft,Ra as b,Sa as x,Ta as P,_ as l,a as lt,b as _t,ca as f,db as bt,ga as S,ha as vt,la as g,nc as It,ob as F,pa as m,pb as xt,ra as dt,sb as I,ta as v,ua as ct,va as w,wa as D,xa as a,ya as i,yb as Ct,yc as Et,za as R,zc as E}from"./chunk-7I6J3OSZ.js";var Nt=(()=>{class n{static \u0275fac=function(s){return new(s||n)};static \u0275mod=vt({type:n});static \u0275inj=pt({imports:[It,Et]})}return n})();function Ht(n,e){return this.character.statModifiers==null?null:this.character.statModifiers[this.stat]}function jt(n,e){if(n&1&&(a(0,"div",8),r(1),i()),n&2){let t=e.$implicit;l(),P(" ",t.source,": ",t.value>0?"+"+t.value:t.value," ")}}function Qt(n,e){if(n&1&&(a(0,"div",6),w(1,jt,2,2,"div",8,Ht,!0),i()),n&2){let t=h();l(),D(t.character.statModifiers==null?null:t.character.statModifiers[t.stat])}}var ht=class n{static \u0275fac=function(t){return new(t||n)};static \u0275cmp=S({type:n,selectors:[["app-confirmation-dialog"]],decls:12,vars:1,consts:[["mat-dialog-title",""],["align","end"],["mat-button","","mat-dialog-close",""],["mat-button","","color","primary",3,"mat-dialog-close"]],template:function(t,s){t&1&&(a(0,"h2",0),r(1,"Reroll Education"),i(),a(2,"mat-dialog-content")(3,"p"),r(4,"You are about to reroll your Education (EDU) stat. This will also reroll any improvement checks associated with Education."),i(),a(5,"p"),r(6,"Are you sure you want to continue?"),i()(),a(7,"mat-dialog-actions",1)(8,"button",2),r(9,"Cancel"),i(),a(10,"button",3),r(11,"Confirm"),i()()),t&2&&(l(10),m("mat-dialog-close",!0))},dependencies:[M,E,O,Pt,Ot,Ut,Ft],encapsulation:2})},rt=class n{constructor(e,t){this.diceService=e;this.dialog=t}character;stat;name;desc;statRolled=new gt;get tooltipText(){return["siz","int","edu"].includes(this.stat)?"":"Roll 3D6 \xD7 5 for STR"}rollStat(){this.stat==="edu"&&this.character.improvementRolls&&this.character.improvementRolls.edu&&this.character.improvementRolls.edu.length>0?this.dialog.open(ht).afterClosed().subscribe(t=>{t===!0&&this.performRoll()}):this.performRoll()}performRoll(){let e;["siz","int","edu"].includes(this.stat)?e=(this.diceService.roll2d6()+6)*5:e=this.diceService.roll3d6()*5,this.statRolled.emit({value:e,stat:this.stat})}static \u0275fac=function(t){return new(t||n)(f(U),f(Vt))};static \u0275cmp=S({type:n,selectors:[["app-stat-card"]],inputs:{character:"character",stat:"stat",name:"name",desc:"desc"},outputs:{statRolled:"statRolled"},decls:15,vars:6,consts:[[1,"stat-card"],[1,"stat-header"],["mat-mini-fab","","color","accent",1,"dice-btn",3,"click","matTooltip"],[1,"stat-value"],[1,"stat-calculation"],[1,"stat-base-value"],[1,"stat-modifiers"],[1,"stat-desc"],[1,"modifier"]],template:function(t,s){t&1&&(a(0,"div",0)(1,"div",1)(2,"h3"),r(3),i(),a(4,"button",2),u("click",function(){return s.rollStat()}),a(5,"mat-icon"),r(6,"casino"),i()()(),a(7,"div",3),r(8),i(),a(9,"div",4)(10,"div",5),r(11),i(),g(12,Qt,3,0,"div",6),i(),a(13,"p",7),r(14),i()()),t&2&&(l(3),b(s.name),l(),m("matTooltip",s.tooltipText),l(4),b(s.character[s.stat]),l(3),x("Base: ",s.character.baseStats[s.stat],""),l(),v(!(s.character.statModifiers==null||s.character.statModifiers[s.stat]==null)&&s.character.statModifiers[s.stat].length?12:-1),l(2),b(s.desc))},dependencies:[M,Tt,y,T,A,k,O,I],styles:[".stat-card[_ngcontent-%COMP%]{background-color:#f9f9f9;padding:15px;border-radius:5px;box-shadow:0 2px 4px #0000001a}.stat-card[_ngcontent-%COMP%]   .stat-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}.stat-card[_ngcontent-%COMP%]   .stat-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:1.1em}.stat-card[_ngcontent-%COMP%]   .stat-desc[_ngcontent-%COMP%]{font-size:.9em;color:#666;margin-top:5px}.stat-card[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%]{font-size:1.6em;font-weight:700;color:#512da8;text-align:center;margin:10px 0}.stat-card[_ngcontent-%COMP%]   .stat-calculation[_ngcontent-%COMP%]{color:#666;font-size:.8em}.stat-card[_ngcontent-%COMP%]   .stat-calculation[_ngcontent-%COMP%]   .stat-modifiers[_ngcontent-%COMP%]{margin-bottom:8px}.stat-card[_ngcontent-%COMP%]   .stat-calculation[_ngcontent-%COMP%]   .stat-modifiers[_ngcontent-%COMP%]   .modifier[_ngcontent-%COMP%]{margin-bottom:2px;color:#9c27b0}.stat-card[_ngcontent-%COMP%]   .dice-btn[_ngcontent-%COMP%]{width:30px;height:30px;line-height:30px}.stat-card[_ngcontent-%COMP%]   .dice-btn[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:16px;line-height:16px;height:16px;width:16px}"]})};function te(n,e){n&1&&(a(0,"p"),r(1,"Please select an age range above to determine bonuses and penalties."),i())}function ee(n,e){n&1&&(a(0,"p"),r(1,"No improvement checks have been rolled yet."),i())}function ie(n,e){n&1&&(a(0,"span",12),r(1,"(Success!)"),i())}function ae(n,e){n&1&&(a(0,"span",12),r(1,"(Failed)"),i())}function ne(n,e){if(n&1&&(a(0,"div",13)(1,"span"),r(2),i()()),n&2){let t=h().$implicit;l(2),x("Improvement: +",t.improvement,"")}}function re(n,e){if(n&1&&(a(0,"div",7)(1,"div",8)(2,"div",9)(3,"span",10),r(4),i()(),a(5,"span",11),r(6),g(7,ie,2,0,"span",12)(8,ae,2,0,"span",12),i(),g(9,ne,3,1,"div",13),i()()),n&2){let t=e.$implicit,s=e.$index;dt("success",t.success)("failure",!t.success),l(4),x("Check #",s+1,""),l(),m("matTooltip","Roll: "+t.check+" vs Target: "+t.target),l(),P(" ",t.check," vs ",t.target," "),l(),v(t.success?7:8),l(2),v(t.success?9:-1)}}function se(n,e){if(n&1&&(a(0,"p"),r(1,"Your EDU stat has "),a(2,"span",14),r(3,"increased"),i(),r(4),i()),n&2){let t=h(4);l(4),x(" by ",t.eduImprovementAmount," points total.")}}function oe(n,e){n&1&&(a(0,"p"),r(1,"You failed all improvement checks - your EDU stat has not changed."),i())}function le(n,e){if(n&1&&(a(0,"div",4),w(1,re,10,10,"div",5,ct),i(),a(3,"div",6),g(4,se,5,1,"p")(5,oe,2,0,"p"),i()),n&2){let t=h(3);l(),D(t.improvementRolls),l(3),v(t.eduImprovementsCount>0?4:5)}}function de(n,e){if(n&1){let t=V();a(0,"div",0)(1,"div",2)(2,"h3"),r(3),i(),a(4,"button",3),u("click",function(){_(t);let d=h(2);return p(d.rerollAllImprovementChecks())}),a(5,"mat-icon"),r(6,"casino"),i(),r(7," Reroll All Checks "),i()(),g(8,ee,2,0,"p")(9,le,6,1),i()}if(n&2){let t=h(2);l(3),x("EDU Improvement Checks (",t.improvementChecksCount,")"),l(5),v(t.improvementRolls.length===0?8:9)}}function ce(n,e){if(n&1){let t=V();a(0,"div",18)(1,"div",19),r(2),i(),a(3,"div",20)(4,"mat-form-field",21)(5,"mat-label"),r(6,"Deduct"),i(),a(7,"input",22),u("change",function(){let d=_(t).$implicit,o=h(3);return p(o.onAgeDeductionChange(d))}),i()()()()}if(n&2){let t=e.$implicit,s=h(3);l(2),b(t.toUpperCase()),l(5),m("max",s.getRemainingDeductionPoints()+s.getDeductionPerStat(t))("formControlName",t)}}function me(n,e){n&1&&(a(0,"p"),r(1,"5 points have been "),a(2,"span",23),r(3,"deducted"),i(),r(4," from EDU. Your LUCK has been rerolled with advantage."),i())}function he(n,e){if(n&1&&(a(0,"form",1)(1,"h3"),r(2,"Penalties"),i(),a(3,"p"),r(4),i(),a(5,"p",15),r(6),i(),a(7,"div",16),g(8,ce,8,3,"div",17),i(),R(9,"br"),g(10,me,5,0,"p"),i()),n&2){let t=h(2);m("formGroup",t.ageDeductionForm),l(4),x("Due to your character's age, you must reduce the following statistics by a total of ",t.ageDeductionInfo.totalPoints," points."),l(2),x("Remaining points to distribute: ",t.getRemainingDeductionPoints(),""),l(2),m("ngForOf",t.ageDeductionInfo.stats),l(2),v(t.ageRange.id===1?10:-1)}}function ue(n,e){if(n&1&&(r(0),g(1,de,10,2,"div",0)(2,he,11,5,"form",1)),n&2){let t=h();P(' If you are "',t.ageRange.name,'", you receive ',t.ageRange.eduImprovementChecks," improvement checks for your EDU stat. "),l(),v(t.ageRange.id>1?1:-1),l(),v(t.ageRange.id!==2&&t.ageDeductionForm?2:-1)}}var st=class n{constructor(e,t,s,d,o){this.characterService=e;this.ageEffectsService=t;this.rollService=s;this.fb=d;this.cdr=o}ageRange;character;ageDeductionChange=ft();deductionAmounts={};ageDeductionForm;improvementRolls=[];get eduImprovementsCount(){return!this.character||!this.character.statModifiers||!this.character.statModifiers.edu?0:this.character.statModifiers.edu.filter(e=>e.source==="Improvement Check").length}get eduImprovementAmount(){if(!this.character||!this.character.statModifiers||!this.character.statModifiers.edu)return 0;let e=this.character.statModifiers.edu.filter(t=>t.source==="Improvement Check");return e.length===0?0:e.reduce((t,s)=>t+s.value,0)}get improvementChecksCount(){if(!this.ageRange)return 0;switch(this.ageRange.id){case 1:return 0;case 2:return 1;case 3:return 2;case 4:return 3;case 5:case 6:case 7:return 4;default:return 0}}ageDeductionInfo={totalPoints:0,stats:[],usedPoints:{}};ngOnInit(){this.initForm(),this.characterService.getCharacter().subscribe(e=>{this.character=e,this.loadImprovementRolls()})}loadImprovementRolls(){if(this.ageRange?.id===1){this.improvementRolls=[];return}if(this.improvementRolls=this.rollService.getImprovementRolls(this.character,"edu"),this.improvementRolls.length===0&&this.improvementChecksCount>0){let e=this.rollService.makeImprovementCheck(this.character,"edu",this.improvementChecksCount);this.improvementRolls=e.rolls,this.characterService.updateCharacter(this.character)}this.cdr.detectChanges()}rerollAllImprovementChecks(){this.character&&(this.rollService.rerollAllImprovementChecks(this.character,"edu"),this.loadImprovementRolls(),this.characterService.updateCharacter(this.character))}initForm(){this.ageDeductionInfo=this.ageEffectsService.getAgeDeductionInfo();let e={};this.ageDeductionInfo.stats.forEach(t=>{let s=this.ageDeductionInfo.usedPoints[t]||0,d=this.ageEffectsService.getAgeDeductionRemainingPoints();e[t]=[s,[C.min(0),C.max(d+s)]],this.deductionAmounts[t]=s}),this.ageDeductionForm=this.fb.group(e),this.ageDeductionForm.valueChanges.subscribe(t=>{})}getRemainingDeductionPoints(){return this.ageEffectsService.getAgeDeductionRemainingPoints()}getDeductionPerStat(e){return this.ageEffectsService.getAgeDeductionUsedForStat(e)}onAgeDeductionChange(e){if(!this.character||!this.ageDeductionForm)return;let t=this.ageDeductionForm.get(e)?.value;if(t==null)return;let s=this.ageEffectsService.getAgeDeductionUsedForStat(e);if(s===t)return;let d=t-s;if(d>this.ageEffectsService.getAgeDeductionRemainingPoints()){this.ageDeductionForm.get(e)?.setValue(s);return}this.ageEffectsService.applyStatDeduction(this.character,e,d),this.ageDeductionInfo=this.ageEffectsService.getAgeDeductionInfo();let o=this.ageEffectsService.getAgeDeductionRemainingPoints();this.ageDeductionInfo.stats.forEach(c=>{let ot=this.ageEffectsService.getAgeDeductionUsedForStat(c);this.ageDeductionForm?.get(c)?.setValidators([C.min(0),C.max(o+ot)]),this.ageDeductionForm?.get(c)?.updateValueAndValidity()}),this.characterService.updateCharacter(this.character),this.ageDeductionChange.emit(this.ageDeductionInfo)}static \u0275fac=function(t){return new(t||n)(f(N),f(Rt),f(Mt),f(Y),f(bt))};static \u0275cmp=S({type:n,selectors:[["app-age-effects-card"]],inputs:{ageRange:"ageRange"},outputs:{ageDeductionChange:"ageDeductionChange"},decls:8,vars:1,consts:[[1,"improvement-rolls-container"],[3,"formGroup"],[1,"rolls-header"],["mat-raised-button","","color","accent","matTooltip","Reroll all improvement checks",1,"reroll-all-btn",3,"click"],[1,"improvement-rolls"],[1,"improvement-roll",3,"success","failure"],[1,"improvement-summary"],[1,"improvement-roll"],[1,"roll-details"],[1,"roll-header"],[1,"roll-index"],[1,"roll-result",3,"matTooltip"],[1,"roll-status"],[1,"improvement-amount"],[1,"color-green"],[1,"remaining-points"],[1,"deduction-grid"],["class","deduction-item",4,"ngFor","ngForOf"],[1,"deduction-item"],[1,"stat-name"],[1,"deduction-input"],[1,"small-width"],["matInput","","type","number","min","0",3,"change","max","formControlName"],[1,"color-red"]],template:function(t,s){t&1&&(a(0,"mat-card")(1,"mat-card-content")(2,"h2"),r(3,"Age Effects"),i(),a(4,"p"),r(5,"Your character's age may apply certain bonuses or penalties. Typically the older you are, the more educated you become, but at the cost of strength or dexterity."),i(),g(6,te,2,0,"p")(7,ue,3,4),i()()),t&2&&(l(6),v(s.ageRange?7:6))},dependencies:[I,F,K,H,W,j,L,$,Z,q,X,B,z,it,et,tt,nt,at,M,E,A,k,y,T,J,Q,G],styles:[".color-red[_ngcontent-%COMP%]{color:#e53935;font-weight:700}.color-green[_ngcontent-%COMP%]{color:#43a047;font-weight:700}.remaining-points[_ngcontent-%COMP%]{font-weight:700;color:#f44336;margin-bottom:15px}.deduction-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(125px,1fr));gap:20px;margin-top:20px}.deduction-grid[_ngcontent-%COMP%]   .deduction-item[_ngcontent-%COMP%]{background-color:#f5f5f5;padding:15px;border-radius:5px;box-shadow:0 2px 4px #0000001a}.deduction-grid[_ngcontent-%COMP%]   .deduction-item[_ngcontent-%COMP%]   .stat-name[_ngcontent-%COMP%]{font-weight:700;font-size:1.1em;margin-bottom:5px;color:#512da8}.deduction-grid[_ngcontent-%COMP%]   .deduction-item[_ngcontent-%COMP%]   .deduction-input[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;margin-top:10px}.deduction-grid[_ngcontent-%COMP%]   .deduction-item[_ngcontent-%COMP%]   .deduction-input[_ngcontent-%COMP%]   .small-width[_ngcontent-%COMP%]{width:80px}.improvement-rolls-container[_ngcontent-%COMP%]{margin-top:16px;margin-bottom:20px;padding:16px;border-radius:5px;background-color:#f5f5f5;box-shadow:0 2px 4px #0000001a}.improvement-rolls-container[_ngcontent-%COMP%]   .rolls-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}.improvement-rolls-container[_ngcontent-%COMP%]   .rolls-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;color:#512da8;font-size:1.1em}.improvement-rolls-container[_ngcontent-%COMP%]   .rolls-header[_ngcontent-%COMP%]   .reroll-all-btn[_ngcontent-%COMP%]{display:flex;align-items:center;gap:6px}.improvement-rolls[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px;margin-bottom:16px}.improvement-roll[_ngcontent-%COMP%]{padding:15px;border-radius:5px;background-color:#f9f9f9;box-shadow:0 2px 4px #0000001a}.improvement-roll.success[_ngcontent-%COMP%]{border-left:4px solid #43a047}.improvement-roll.failure[_ngcontent-%COMP%]{border-left:4px solid #e53935}.roll-details[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px}.roll-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}.roll-index[_ngcontent-%COMP%]{font-weight:700;color:#512da8;font-size:1.1em}.roll-result[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;font-size:1.2em;font-weight:700;margin:10px 0}.roll-status[_ngcontent-%COMP%]{font-weight:700}.success[_ngcontent-%COMP%]   .roll-status[_ngcontent-%COMP%]{color:#43a047}.failure[_ngcontent-%COMP%]   .roll-status[_ngcontent-%COMP%]{color:#e53935}.improvement-amount[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-top:5px;color:#43a047;font-weight:700}.improvement-summary[_ngcontent-%COMP%]{margin-top:20px;font-weight:700;text-align:center}.improvement-summary[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:8px 0}.dice-btn[_ngcontent-%COMP%]{width:30px;height:30px;line-height:30px}.dice-btn.small[_ngcontent-%COMP%]{width:24px;height:24px;line-height:24px}.dice-btn[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:16px;line-height:16px;height:16px;width:16px}.dice-btn.small[_ngcontent-%COMP%]   .dice-btn[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:12px;line-height:12px;height:12px;width:12px}"],changeDetection:0})};function _e(n,e){n&1&&(a(0,"mat-error"),r(1," Name is required "),i())}function pe(n,e){if(n&1&&(a(0,"option",31),r(1),i()),n&2){let t=e.$implicit,s=h(2);m("value",t.id)("selected",t.id===(s.selectedAgeRange==null?null:s.selectedAgeRange.id)),l(),x(" ",t.selectorName," ")}}function ge(n,e){n&1&&(a(0,"mat-error"),r(1," Age is required "),i())}function fe(n,e){n&1&&(a(0,"mat-error"),r(1," Age must be between 15 and 89 "),i())}function ve(n,e){if(n&1){let t=V();a(0,"div",1)(1,"h1",2),r(2,"Investigator Statistics"),i(),a(3,"form",3)(4,"mat-card")(5,"mat-card-content")(6,"h2"),r(7,"Basic Information"),i(),a(8,"div",4)(9,"mat-form-field",5)(10,"mat-label"),r(11,"Character Name"),i(),R(12,"input",6),g(13,_e,2,0,"mat-error",7),i()(),a(14,"div",4)(15,"mat-form-field",5)(16,"mat-label"),r(17,"Age Range (Apply Effects)"),i(),a(18,"select",8),u("change",function(d){_(t);let o=h();return p(o.onAgeRangeChange(d))}),a(19,"option",9),r(20,"Select age range"),i(),g(21,pe,2,3,"option",10),i()(),a(22,"mat-form-field",5)(23,"mat-label"),r(24,"Age"),i(),R(25,"input",11),g(26,ge,2,0,"mat-error",7)(27,fe,2,0,"mat-error",7),i()()()(),a(28,"app-age-effects-card",12),u("ageDeductionChange",function(d){_(t);let o=h();return p(o.onAgeDeductionChange(d))}),i(),a(29,"mat-card")(30,"mat-card-content")(31,"div",13)(32,"h2"),r(33,"Characteristics"),i(),a(34,"button",14),u("click",function(){_(t);let d=h();return p(d.rollAllStats())}),a(35,"mat-icon"),r(36,"casino"),i(),r(37," Roll All Stats "),i()(),a(38,"div",15)(39,"app-stat-card",16),u("statRolled",function(d){_(t);let o=h();return p(o.onStatRoll(d))}),i(),a(40,"app-stat-card",17),u("statRolled",function(d){_(t);let o=h();return p(o.onStatRoll(d))}),i(),a(41,"app-stat-card",18),u("statRolled",function(d){_(t);let o=h();return p(o.onStatRoll(d))}),i(),a(42,"app-stat-card",19),u("statRolled",function(d){_(t);let o=h();return p(o.onStatRoll(d))}),i(),a(43,"app-stat-card",20),u("statRolled",function(d){_(t);let o=h();return p(o.onStatRoll(d))}),i(),a(44,"app-stat-card",21),u("statRolled",function(d){_(t);let o=h();return p(o.onStatRoll(d))}),i(),a(45,"app-stat-card",22),u("statRolled",function(d){_(t);let o=h();return p(o.onStatRoll(d))}),i(),a(46,"app-stat-card",23),u("statRolled",function(d){_(t);let o=h();return p(o.onStatRoll(d))}),i(),a(47,"app-stat-card",24),u("statRolled",function(d){_(t);let o=h();return p(o.onStatRoll(d))}),i()()()(),a(48,"mat-card")(49,"mat-card-content")(50,"h2"),r(51,"Derived Attributes"),i(),a(52,"div",25)(53,"div",26)(54,"h3"),r(55,"Hit Points"),i(),a(56,"div",27),r(57),i(),a(58,"p",28),r(59,"(CON + SIZ) / 10, rounded down"),i()(),a(60,"div",26)(61,"h3"),r(62,"Damage Bonus"),i(),a(63,"div",27),r(64),i(),a(65,"p",28),r(66,"Based on STR + SIZ"),i()(),a(67,"div",26)(68,"h3"),r(69,"Build"),i(),a(70,"div",27),r(71),i(),a(72,"p",28),r(73,"Based on STR + SIZ"),i()(),a(74,"div",26)(75,"h3"),r(76,"Movement Rate"),i(),a(77,"div",27),r(78),i(),a(79,"p",28),r(80,"Based on STR, DEX, SIZ, and age"),i()()()()(),a(81,"div",29)(82,"button",30),u("click",function(){_(t);let d=h();return p(d.saveAndContinue())}),r(83," Save and Continue "),i()()()()}if(n&2){let t,s,d,o=h();l(3),m("formGroup",o.statsForm),l(10),m("ngIf",(t=o.statsForm.get("name"))==null?null:t.hasError("required")),l(8),m("ngForOf",o.ageRanges),l(4),m("min",(o.selectedAgeRange==null?null:o.selectedAgeRange.min)||15)("max",(o.selectedAgeRange==null?null:o.selectedAgeRange.max)||89),l(),m("ngIf",(s=o.statsForm.get("age"))==null?null:s.hasError("required")),l(),m("ngIf",((d=o.statsForm.get("age"))==null?null:d.hasError("min"))||((d=o.statsForm.get("age"))==null?null:d.hasError("max"))),l(),m("ageRange",o.selectedAgeRange),l(11),m("character",o.character),l(),m("character",o.character),l(),m("character",o.character),l(),m("character",o.character),l(),m("character",o.character),l(),m("character",o.character),l(),m("character",o.character),l(),m("character",o.character),l(),m("character",o.character),l(10),b(o.derivedHP),l(7),b(o.derivedDamageBonus),l(7),b(o.derivedBuild),l(7),b(o.derivedMovementRate),l(4),m("disabled",o.statsForm.invalid)}}var Lt=class n{constructor(e,t,s,d,o){this.fb=e;this.characterService=t;this.diceService=s;this.ageRangeService=d;this.router=o;this.ageRanges=this.ageRangeService.getAllAgeRanges().map(c=>_t(lt({},c),{label:`${c.min}-${c.max} (${c.name})`,value:Math.floor((c.min+c.max)/2)}))}statsForm;character;pendingDeduction=null;derivedHP=0;derivedDamageBonus="None";derivedBuild=0;derivedMovementRate=8;ageRanges=[];selectedAgeRange;ngOnInit(){this.characterService.getCharacter().subscribe(e=>{console.log(e),this.character=e,this.initializeAgeRange(),this.initForm()})}initializeAgeRange(){this.selectedAgeRange||(this.selectedAgeRange=this.ageRanges.find(e=>this.character.age>=e.min&&this.character.age<=e.max))}initForm(){this.statsForm=this.fb.group({name:[this.character.name,C.required],age:[this.character.age,[C.required,C.min(15),C.max(89)]]}),this.recalculateDerivedAttributes(),this.statsForm.valueChanges.subscribe(()=>{this.recalculateDerivedAttributes()})}recalculateDerivedAttributes(){let e=this.statsForm&&Number(this.statsForm.get("age")?.value)||20,t=this.character.str,s=this.character.con,d=this.character.siz,o=this.character.dex;this.derivedHP=Math.floor((s+d)/10);let c=t+d;if(c>=2&&c<=64)this.derivedDamageBonus="-2",this.derivedBuild=-2;else if(c>=65&&c<=84)this.derivedDamageBonus="-1",this.derivedBuild=-1;else if(c>=85&&c<=124)this.derivedDamageBonus="None",this.derivedBuild=0;else if(c>=125&&c<=164)this.derivedDamageBonus="+1d4",this.derivedBuild=1;else if(c>=165&&c<=204)this.derivedDamageBonus="+1d6",this.derivedBuild=2;else if(c>=205&&c<=284)this.derivedDamageBonus="+2d6",this.derivedBuild=3;else if(c>=285&&c<=364)this.derivedDamageBonus="+3d6",this.derivedBuild=4;else if(c>=365&&c<=444)this.derivedDamageBonus="+4d6",this.derivedBuild=5;else if(c>=445){let ut=Math.floor((c-445)/80)+5;this.derivedDamageBonus=`+${ut}d6`,this.derivedBuild=ut}t<d&&o<d?this.derivedMovementRate=7:t>=d||o>=d||t===d&&o===d?this.derivedMovementRate=8:t>d&&o>d&&(this.derivedMovementRate=9);let ot=this.ageRangeService.getMovementPenalty(e);this.derivedMovementRate-=ot,this.derivedMovementRate<1&&(this.derivedMovementRate=1)}rollAllStats(){let e=this.diceService.generateBaseStats();this.character.baseStats=lt({},e),this.character.str=e.str,this.character.con=e.con,this.character.siz=e.siz,this.character.dex=e.dex,this.character.app=e.app,this.character.int=e.int,this.character.pow=e.pow,this.character.edu=e.edu,this.character.luck=e.luck,this.character.statModifiers&&Object.keys(this.character.statModifiers).forEach(t=>{this.character&&this.character.statModifiers&&(this.character.statModifiers[t]=[])}),this.characterService.applyAgeEffects(this.character,this.character.age),this.recalculateDerivedAttributes()}onAgeRangeChange(e){let t=parseInt(e.target.value);if(this.selectedAgeRange=this.ageRanges.find(s=>s.id===t),this.selectedAgeRange){let s=this.getRandomNumber(this.selectedAgeRange.min,this.selectedAgeRange.max);this.statsForm.get("age")?.setValue(s),this.characterService.applyAgeEffects(this.character,s)}}getRandomNumber(e,t){return Math.floor(Math.random()*(t-e+1))+e}updateCharacterFromForm(){if(!this.statsForm.valid)return;let e=this.statsForm.value;this.character.name=e.name,this.character.age=e.age,this.character.hp=this.derivedHP,this.character.damageBonus=this.derivedDamageBonus,this.character.build=this.derivedBuild,this.character.mov=this.derivedMovementRate,this.characterService.updateCharacter(this.character)}saveAndContinue(){this.statsForm.valid&&(this.updateCharacterFromForm(),this.router.navigate(["/occupation"]))}onAgeDeductionChange(e){this.recalculateDerivedAttributes()}getCurrentStatValue(e){return this.character[e]}onStatRoll(e){this.character.baseStats[e.stat]=e.value,this.character[e.stat]=e.value,e.stat==="edu"&&this.character.improvementRolls?.edu?(this.character.improvementRolls.edu=[],this.character.statModifiers?.edu&&(this.character.statModifiers.edu=this.character.statModifiers.edu.filter(t=>t.source!=="Improvement Check")),this.characterService.applyAgeEffects(this.character,this.character.age)):this.character.statModifiers&&this.character.statModifiers[e.stat]&&this.character.statModifiers[e.stat]?.forEach(t=>{this.character?.[e.stat]&&(this.character[e.stat]+=t.value)}),this.recalculateDerivedAttributes(),this.characterService.updateCharacter(this.character)}static \u0275fac=function(t){return new(t||n)(f(Y),f(N),f(U),f(St),f(Ct))};static \u0275cmp=S({type:n,selectors:[["app-stats-editor"]],decls:1,vars:1,consts:[["class","container",4,"ngIf"],[1,"container"],[1,"section-title"],[3,"formGroup"],[1,"form-row"],[1,"form-field-full-width"],["matInput","","formControlName","name","placeholder","Enter investigator name"],[4,"ngIf"],["matNativeControl","",3,"change"],["value",""],[3,"value","selected",4,"ngFor","ngForOf"],["matInput","","formControlName","age","type","number",3,"min","max"],[3,"ageDeductionChange","ageRange"],[1,"space-between"],["mat-raised-button","","color","primary","matTooltip","Roll for all characteristics at once (using appropriate dice for each stat)",3,"click"],[1,"stat-grid"],["stat","str","name","STR (Strength)","desc","Physical power and muscle",3,"statRolled","character"],["stat","con","name","CON (Constitution)","desc","Health and resilience",3,"statRolled","character"],["stat","siz","name","SIZ (Size)","desc","Physical mass and stature",3,"statRolled","character"],["stat","dex","name","DEX (Dexterity)","desc","Agility and reflexes",3,"statRolled","character"],["stat","app","name","APP (Appearance)","desc","Charisma and looks",3,"statRolled","character"],["stat","int","name","INT (Intelligence)","desc","Problem-solving and learning",3,"statRolled","character"],["stat","pow","name","POW (Power)","desc","Willpower and spirit",3,"statRolled","character"],["stat","edu","name","EDU (Education)","desc","Learning and knowledge",3,"statRolled","character"],["stat","luck","name","Luck","desc","Fate and fortune",3,"statRolled","character"],[1,"derived-grid"],[1,"derived-item"],[1,"derived-value"],[1,"stat-desc"],[1,"actions-container"],["mat-raised-button","","color","primary",3,"click","disabled"],[3,"value","selected"]],template:function(t,s){t&1&&g(0,ve,84,22,"div",0),t&2&&m("ngIf",s.character&&s.statsForm)},dependencies:[I,F,xt,J,H,kt,At,W,j,L,$,Z,q,Q,G,K,X,B,z,it,et,tt,wt,nt,at,M,E,y,T,Dt,Nt,yt,A,k,O,rt,st],styles:[".container[_ngcontent-%COMP%]{max-width:1000px;margin:0 auto;padding:20px}.stat-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:20px;margin-top:20px}.derived-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:20px;margin-top:20px}.derived-item[_ngcontent-%COMP%]{background-color:#f0f0f0;padding:15px;border-radius:5px;text-align:center}.derived-value[_ngcontent-%COMP%]{font-size:1.8em;font-weight:700;margin:10px 0;color:#512da8}.actions-container[_ngcontent-%COMP%]{margin-top:30px;display:flex;justify-content:flex-end}.warning-title[_ngcontent-%COMP%]{color:#f44336}.stat-name[_ngcontent-%COMP%]{font-weight:700;font-size:1.1em;margin-bottom:5px;color:#512da8}"],changeDetection:0})};export{Lt as StatsEditorComponent};
